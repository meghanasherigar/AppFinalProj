!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common"],t):t(e["ngx-nestable/lib"]={},e.ng.core,e.ng.common)}(this,function(e,s,t){"use strict";var r=function(e,t,i){void 0===i&&(i=null);for(var n=0;n<e.length;n++){var s=e[n];if(void 0!==s){if(t(s,i))break;s.children&&r(s.children,t,s)}}},m=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},u=function(e,t){void 0===t&&(t=document.body);for(var i=[],n=e.parentNode;n!==t;){var s=n;if(!n)break;n.tagName===t.tagName&&i.push(s),n=s.parentNode}return i.push(t),i},g=function(e,t){var i,n;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]&&(i=e,!0)});e&&null!==(n=e.parentElement);){var s=n[i](t);if(n&&s)return n;e=n}return null},f=function(e){var t={top:0,left:0};return typeof e.getBoundingClientRect!==undefined&&(t=e.getBoundingClientRect()),{top:t.top+(window.pageYOffset||e.scrollTop)-(e.clientTop||0),left:t.left+(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}},i="NESTABLE_DRAG_HANDLE_REGISTER",n="NESTABLE_DRAG_HANDLE_START",o="NESTABLE_EXPAND_COLLAPSE_EVENT",l={listNodeName:"ul",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",group:0,maxDepth:5,threshold:20,fixedDepth:!1,exportCollapsed:!0,disableDrag:!1},a={moving:0,offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},_="px",E=function(){var e=document.createElement("div"),t=document.documentElement;if(!("pointerEvents"in e.style))return!1;e.style.pointerEvents="auto",e.style.pointerEvents="x",t.appendChild(e);var i=window.getComputedStyle&&"auto"===window.getComputedStyle(e,"").pointerEvents;return t.removeChild(e),!!i}(),d=function(){function e(e,t,i,n){this.ref=e,this.renderer=t,this.el=i,this.zone=n,this.listChange=new s.EventEmitter,this.drop=new s.EventEmitter,this.drag=new s.EventEmitter,this.disclosure=new s.EventEmitter,this.options=l,this.disableDrag=!1,this.dragRootEl=null,this.dragEl=null,this.dragModel=null,this.moving=!1,this.dragDepth=0,this.relativeDepth=0,this.hasNewRoot=!1,this.pointEl=null,this.items=[],this._componentActive=!1,this._mouse=Object.assign({},a),this._list=[],this._itemId=0,this._registerHandleDirective=!1}return Object.defineProperty(e.prototype,"list",{get:function(){return this._list},set:function(e){this._list=e,this._generateItemIds()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._componentActive=!0;for(var e=0,t=Object.keys(l);e<t.length;e++){var i=t[e];"undefined"==typeof this.options[i]&&(this.options[i]=l[i])}this._generateItemIds(),this._generateItemExpanded(),this._createHandleListener()},e.prototype.ngOnDestroy=function(){},e.prototype._generateItemIds=function(){var t=this;r(this._list,function(e){e.$$id=t._itemId++})},e.prototype._generateItemExpanded=function(){r(this._list,function(e){"undefined"==typeof e.expanded?e.$$expanded=!0:e.$$expanded=e.expanded})},e.prototype._createHandleListener=function(){var t=this;this.renderer.listen(this.el.nativeElement,i,function(){t._registerHandleDirective=!0}),this.renderer.listen(this.el.nativeElement,n,function(e){t.dragStart(e.detail.event,e.detail.param.item,e.detail.param.parentList)}),this.renderer.listen(this.el.nativeElement,o,function(e){t.disclosure.emit({item:e.detail.item,expanded:e.detail.item.$$expanded})})},e.prototype._createDragClone=function(e,t){this._mouseStart(e,t),this._registerHandleDirective||(this._mouse.offsetY=t.nextElementSibling?t.nextElementSibling.clientHeight/2:t.clientHeight/2),this.dragEl=document.createElement(this.options.listNodeName),document.body.appendChild(this.dragEl),this.renderer.addClass(this.dragEl,this.options.dragClass),this.renderer.setStyle(this.dragEl,"left",e.pageX-this._mouse.offsetX+_),this.renderer.setStyle(this.dragEl,"top",e.pageY-this._mouse.offsetY+_),this.renderer.setStyle(this.dragEl,"position","absolute"),this.renderer.setStyle(this.dragEl,"z-index",9999),this.renderer.setStyle(this.dragEl,"pointer-events","none")},e.prototype._createPlaceholder=function(e,t){this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.options.placeClass),m(this._placeholder,t),t.parentNode.removeChild(t),this.dragEl.appendChild(t),this.dragRootEl=t},e.prototype._calculateDepth=function(){for(var e,t=this.dragEl.querySelectorAll(this.options.itemNodeName),i=0;i<t.length;i++)(e=u(t[i],this.dragEl).length)>this.dragDepth&&(this.dragDepth=e);this.relativeDepth=u(this._placeholder,this.el.nativeElement.querySelector(this.options.listNodeName)).length},e.prototype._mouseStart=function(e,t){this._mouse.offsetX=e.pageX-f(t).left,this._mouse.offsetY=e.pageY-f(t).top,this._mouse.startX=this._mouse.lastX=e.pageX,this._mouse.startY=this._mouse.lastY=e.pageY},e.prototype._mouseUpdate=function(e){this._mouse.lastX=this._mouse.nowX,this._mouse.lastY=this._mouse.nowY,this._mouse.nowX=e.pageX,this._mouse.nowY=e.pageY,this._mouse.distX=this._mouse.nowX-this._mouse.lastX,this._mouse.distY=this._mouse.nowY-this._mouse.lastY,this._mouse.lastDirX=this._mouse.dirX,this._mouse.lastDirY=this._mouse.dirY,this._mouse.dirX=0===this._mouse.distX?0:0<this._mouse.distX?1:-1,this._mouse.dirY=0===this._mouse.distY?0:0<this._mouse.distY?1:-1},e.prototype._showMasks=function(){for(var e=this.el.nativeElement.getElementsByClassName("nestable-item-mask"),t=0;t<e.length;t++)e[t].style.display="block"},e.prototype._hideMasks=function(){for(var e=this.el.nativeElement.getElementsByClassName("nestable-item-mask"),t=0;t<e.length;t++)e[t].style.display="none"},e.prototype._calcMouseDistance=function(e){e.distAxX+=Math.abs(e.distX),0!==e.dirX&&e.dirX!==e.lastDirX&&(e.distAxX=0),e.distAxY+=Math.abs(e.distY),0!==e.dirY&&e.dirY!==e.lastDirY&&(e.distAxY=0)},e.prototype._move=function(e){var t;this.dragEl.getBoundingClientRect();this.renderer.setStyle(this.dragEl,"left",e.pageX-this._mouse.offsetX+_),this.renderer.setStyle(this.dragEl,"top",e.pageY-this._mouse.offsetY+_),this._mouseUpdate(e);var i=Math.abs(this._mouse.distX)>Math.abs(this._mouse.distY)?1:0;if(!this._mouse.moving)return this._mouse.dirAx=i,void(this._mouse.moving=1);this._mouse.dirAx!==i?(this._mouse.distAxX=0,this._mouse.distAxY=0):this._calcMouseDistance(this._mouse),this._mouse.dirAx=i,E||(this.dragEl.style.visibility="hidden");var n=document.elementFromPoint(e.pageX-document.body.scrollLeft,e.pageY-(window.pageYOffset||document.documentElement.scrollTop));if(E||(this.dragEl.style.visibility="visible"),n&&(n.classList.contains("nestable-item-mask")||n.classList.contains(this.options.placeClass))){if(this.pointEl=n.parentElement.parentElement,!this.options.fixedDepth&&this._mouse.dirAx&&this._mouse.distAxX>=this.options.threshold){this._mouse.distAxX=0;var s=this._placeholder.previousElementSibling;if(0<this._mouse.distX&&s&&(t=(t=s.querySelectorAll(this.options.listNodeName))[t.length-1],u(this._placeholder,this.el.nativeElement.querySelector(this.options.listNodeName)).length+this.dragDepth<=this.options.maxDepth&&(t?(t=s.querySelector(":scope > "+this.options.listNodeName)).appendChild(this._placeholder):((t=document.createElement(this.options.listNodeName)).style.paddingLeft=this.options.threshold+_,t.appendChild(this._placeholder),s.appendChild(t)))),this._mouse.distX<0){var o=document.querySelector("."+this.options.placeClass+" + "+this.options.itemNodeName),l=this._placeholder.parentElement;if(!o&&l){var r=g(this._placeholder,this.options.itemNodeName);r&&(l.removeChild(this._placeholder),m(this._placeholder,r))}}}if(n.classList.contains("nestable-item-mask")){var a=g(this.pointEl,"."+this.options.rootClass),d=!!a&&this.dragRootEl.dataset["nestable-id"]!==a.dataset["nestable-id"];if(!this._mouse.dirAx||d){if(d&&this.options.group!==a.dataset["nestable-group"])return;if(this.dragDepth-1+u(this.pointEl,this.el.nativeElement.querySelector(this.options.listNodeName)).length>this.options.maxDepth)return;var h,p=e.pageY<f(this.pointEl).top+this.pointEl.clientHeight/2;this._placeholder.parentNode;if(h=u(this.pointEl,this.el.nativeElement.querySelector(this.options.listNodeName)).length,this.options.fixedDepth)if(h===this.relativeDepth-1){var c=this.pointEl.querySelector(this.options.listNodeName);c.children.length||c.appendChild(this._placeholder)}else h===this.relativeDepth&&(p?this.pointEl.parentElement.insertBefore(this._placeholder,this.pointEl):m(this._placeholder,this.pointEl),Array.prototype.indexOf.call(this.pointEl.parentElement.children,this.pointEl)===this.pointEl.parentElement.children.length-1&&m(this._placeholder,this.pointEl));else p?this.pointEl.parentElement.insertBefore(this._placeholder,this.pointEl):m(this._placeholder,this.pointEl)}}}},e.prototype.reset=function(){for(var e=0,t=Object.keys(this._mouse);e<t.length;e++){var i=t[e];this._mouse[i]=0}this._itemId=0,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.relativeDepth=0,this.hasNewRoot=!1,this.pointEl=null},e.prototype.dragStartFromItem=function(e,t,i){this._registerHandleDirective||this.dragStart(e,t,i)},e.prototype.dragStart=function(e,t,i){if(this._oldListLength=this.list.length,!this.options.disableDrag){if(e.stopPropagation(),e.preventDefault(),e.originalEvent&&(e=e.originalEvent),0===e.type.indexOf("mouse")){if(0!==e.button)return}else if(1!==e.touches.length)return;this.ref.detach(),this._dragIndex=i.indexOf(t),this.dragModel=i.splice(i.indexOf(t),1)[0];var n=g(e.target,this.options.itemNodeName);if(null===n)return;this._parentDragId=Number.parseInt(n.parentElement.parentElement.id);var s=n.getBoundingClientRect();this._showMasks(),this._createDragClone(e,n),this.renderer.setStyle(this.dragEl,"width",s.width+_),this._createPlaceholder(e,n),this.renderer.setStyle(this._placeholder,"height",s.height+_),this._calculateDepth(),this.drag.emit({originalEvent:e,item:t}),this._cancelMouseup=this.renderer.listen(document,"mouseup",this.dragStop.bind(this)),this._cancelMousemove=this.renderer.listen(document,"mousemove",this.dragMove.bind(this))}},e.prototype.dragStop=function(e){if(this._cancelMouseup(),this._cancelMousemove(),this._hideMasks(),this.dragEl){Number.parseInt(this.dragEl.firstElementChild.id);var t=g(this._placeholder,this.options.itemNodeName),i=this._dragIndex!==Array.prototype.indexOf.call(this._placeholder.parentElement.children,this._placeholder),n=Array.prototype.indexOf.call(this._placeholder.parentElement.children,this._placeholder);this._dragIndex===n&&this._oldListLength===this.list.length&&(i=!0),null===t?this.list.splice(Array.prototype.indexOf.call(this._placeholder.parentElement.children,this._placeholder),0,Object.assign({},this.dragModel)):(s=this.list,o=Number.parseInt(t.id),l=null,r(s,function(e){if(e.$$id===Number.parseInt(o))return l=e,!0}),(t=l).children?t.children.splice(Array.prototype.indexOf.call(this._placeholder.parentElement.children,this._placeholder),0,Object.assign({},this.dragModel)):(t.children=[],t.children.push(Object.assign({},this.dragModel))),n===this._dragIndex&&(i=!1),i||(i=t.$$id!==this._parentDragId)),this._placeholder.parentElement.removeChild(this._placeholder),this.dragEl.parentNode.removeChild(this.dragEl),this.dragEl.remove(),this.reset(),this.listChange.emit(this.list),this.drop.emit({originalEvent:e,destination:t,item:this.dragModel,changedElementPosition:i}),this.ref.reattach()}var s,o,l},e.prototype.dragMove=function(e){this.dragEl&&(e.preventDefault(),e.originalEvent&&(e=e.originalEvent),this._move(0===e.type.indexOf("mouse")?e:e.touches[0]))},e.prototype.expandAll=function(){r(this._list,function(e){e.$$expanded=!0}),this.ref.markForCheck()},e.prototype.collapseAll=function(){r(this._list,function(e){e.$$expanded=!1}),this.ref.markForCheck()},e}();d.decorators=[{type:s.Component,args:[{selector:"ngx-nestable",template:'\n    <ng-container *ngTemplateOutlet="nestableList; context:{nestable: list, depth: 0}">\n    </ng-container>\n\n    <ng-template #nestableList let-nestable="nestable" let-depth="depth">\n      <ul [style.padding-left.px]="depth ? options.threshold : 0"\n        [class]="options.listClass">\n        <li [class]="options.itemClass" [id]="item.$id" *ngFor="let item of nestable">\n\n          <ng-container *ngTemplateOutlet="nestableItem; context:{nestable: nestable, item: item, depth: depth}">\n          </ng-container>\n\n          <ng-container *ngIf="item.children && item.$expanded">\n            <ng-container *ngTemplateOutlet="nestableList; context:{nestable: item.children, depth: depth + 1}">\n            </ng-container>\n          </ng-container>\n\n          <ul [class]="options.listClass" [style.padding-left.px]="options.threshold"></ul>\n        </li>\n      </ul>\n    </ng-template>\n\n    <ng-template #nestableItem let-parentList="nestable" let-item="item" let-depth="depth">\n      <div class="nestable-item-container mat-list-item" (mousedown)="dragStartFromItem($event, item, parentList)">\n        <ng-container *ngTemplateOutlet="template; context:{$implicit: {item: item, parentList: parentList}, depth: depth}">\n        </ng-container>\n\n        <div class="nestable-item-mask"></div>\n      </div>\n    </ng-template>\n  ',styles:["\n    @import url(\"https://fonts.googleapis.com/css?family=Roboto\");\n    ul .dd-placeholder {\n      margin: 5px 0;\n      padding: 0;\n      min-height: 30px;\n      background: #f2fbff;\n      border: 1px dashed #b6bcbf;\n      -webkit-box-sizing: border-box;\n              box-sizing: border-box; }\n\n    ul li .nestable-item-mask {\n      display: none;\n      position: absolute;\n      top: 0;\n      bottom: 0;\n      right: 0;\n      left: 0;\n      z-index: 9998; }\n\n    ul li .nestable-expand-button {\n      display: block;\n      position: relative;\n      cursor: pointer;\n      float: left;\n      width: 25px;\n      height: 14px;\n      padding: 0;\n      white-space: nowrap;\n      overflow: hidden;\n      border: 0;\n      background: transparent;\n      font-size: 18px;\n      line-height: 1;\n      text-align: center;\n      font-weight: bold;\n      outline: 0; }\n\n    ul li .nestable-item-container {\n      position: relative;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-orient: horizontal;\n      -webkit-box-direction: normal;\n          -ms-flex-direction: row;\n              flex-direction: row;\n      -webkit-box-align: center;\n          -ms-flex-align: center;\n              align-items: center;\n      color: rgba(0, 0, 0, 0.87);\n      min-height: 32px;\n      font-size: 16px;\n      font-family: 'Roboto', sans-serif;\n      cursor: pointer;\n      outline: 0;\n      margin-bottom: 2px;\n      padding-left: 8px; }\n\n    ul li .nestable-item-container:hover {\n      background: rgba(0, 0, 0, 0.04); }\n\n    ol, ul {\n      list-style: none; }\n  "],encapsulation:s.ViewEncapsulation.None,changeDetection:s.ChangeDetectionStrategy.OnPush}]}],d.ctorParameters=function(){return[{type:s.ChangeDetectorRef},{type:s.Renderer2},{type:s.ElementRef},{type:s.NgZone}]},d.propDecorators={listChange:[{type:s.Output}],drop:[{type:s.Output}],drag:[{type:s.Output}],disclosure:[{type:s.Output}],template:[{type:s.Input}],options:[{type:s.Input}],disableDrag:[{type:s.Input}],list:[{type:s.Input}]};var h=function(){function e(e){this._el=e}return e.prototype.onMouseDown=function(e){var t={param:this.ngxNestableDragHandle,event:e};this._el.nativeElement.dispatchEvent(new CustomEvent(n,{bubbles:!0,detail:t}))},e.prototype.ngOnInit=function(){this._el.nativeElement.dispatchEvent(new CustomEvent(i,{bubbles:!0,detail:this.ngxNestableDragHandle}))},e}();h.decorators=[{type:s.Directive,args:[{selector:"[ngxNestableDragHandle]"}]}],h.ctorParameters=function(){return[{type:s.ElementRef}]},h.propDecorators={ngxNestableDragHandle:[{type:s.Input}],onMouseDown:[{type:s.HostListener,args:["mousedown",["$event"]]}]};var p=function(){function e(e){this._el=e}return e.prototype.onMouseDown=function(e){e.stopPropagation()},e.prototype.onClick=function(e){this.ngxNestableExpandCollapse.item.$$expanded=!this.ngxNestableExpandCollapse.item.$$expanded,this._el.nativeElement.dispatchEvent(new CustomEvent(o,{bubbles:!0,detail:this.ngxNestableExpandCollapse}))},e}();p.decorators=[{type:s.Directive,args:[{selector:"[ngxNestableExpandCollapse]"}]}],p.ctorParameters=function(){return[{type:s.ElementRef}]},p.propDecorators={ngxNestableExpandCollapse:[{type:s.Input}],onMouseDown:[{type:s.HostListener,args:["mousedown",["$event"]]}],onClick:[{type:s.HostListener,args:["click",["$event"]]}]};var c=function b(){};c.decorators=[{type:s.NgModule,args:[{imports:[t.CommonModule],declarations:[d,h,p],exports:[d,h,p]}]}],c.ctorParameters=function(){return[]},e.NestableComponent=d,e.NestableModule=c,e.ɵa=h,e.ɵb=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-nestable-lib.umd.min.js.map
